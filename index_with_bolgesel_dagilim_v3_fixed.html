<!DOCTYPE html>

<html lang="tr">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Ankara‚Äônƒ±n Sinemasal Kartografyasƒ±</title>
<link href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" rel="stylesheet"/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet.heat/dist/leaflet-heat.js"></script>

<script>
  (function(){
    function ensureHidden() {
      document.querySelectorAll('.leaflet-control-attribution, .leaflet-control-scale').forEach(el => { try{ el.remove(); }catch(e){} });
      const s = document.createElement('style');
      s.id = 'force-hide-leaflet-credits';
      s.innerHTML = '.leaflet-control-attribution, .leaflet-control-scale{display:none !important; visibility:hidden !important; height:0 !important; margin:0 !important; padding:0 !important;}';
      if(!document.getElementById('force-hide-leaflet-credits')) document.head.appendChild(s);
    }
    ensureHidden();
    setTimeout(ensureHidden, 250);
    setTimeout(ensureHidden, 800);
    window._ensureHiddenInterval = setInterval(ensureHidden, 1200);

    function setupScale(map){
      if(!map) return;
      if(window._ensureHiddenInterval) { clearInterval(window._ensureHiddenInterval); window._ensureHiddenInterval = null; }
      let scaleDiv = document.querySelector('.custom-scale');
      if(!scaleDiv){
        scaleDiv = L.DomUtil.create('div', 'custom-scale');
        scaleDiv.style.position = 'absolute';
        scaleDiv.style.bottom = '8px';
        scaleDiv.style.right = '75px';
        scaleDiv.style.background = 'rgba(255,255,255,0.95)';
        scaleDiv.style.padding = '4px 8px';
        scaleDiv.style.borderRadius = '4px';
        scaleDiv.style.fontSize = '11px';
        scaleDiv.style.fontWeight = '600';
        scaleDiv.style.boxShadow = '0 1px 2px rgba(0,0,0,0.08)';
        scaleDiv.style.zIndex = '1000';
        if(map.getContainer()) map.getContainer().appendChild(scaleDiv);
      }
      function updateScale() {
        const lat = map.getCenter().lat * Math.PI / 180;
        const metersPerPixel = 40075016.686 * Math.cos(lat) / Math.pow(2, map.getZoom() + 8);
        const scale = Math.round(1 / (metersPerPixel / 0.000264583));
        scaleDiv.textContent = '1:' + scale.toLocaleString('tr-TR');
      }
      map.on('zoomend moveend viewreset', updateScale);
      updateScale();
      const z = document.querySelector('.leaflet-control-zoom');
      if(z){ z.style.right = '10px'; z.style.bottom = '30px'; z.style.transition = 'right 0.2s, bottom 0.2s'; }
    }

</script>
<style>
html,body{
  height:100%;
  margin:0;
  font-family:-apple-system, BlinkMacSystemFont, 'Helvetica Neue', Helvetica, Arial, sans-serif !important;
  background:#f7f9fb;
  overflow:hidden;
}


#sidebar{
  position:absolute;
  left:0;top:0;
  width:340px;height:100%;
  background:#fff;
  border-right:1px solid #e6eef6;
  box-shadow:2px 0 6px rgba(0,0,0,0.06);
  padding:18px;
  box-sizing:border-box;
  overflow:auto;
  transition:transform .35s ease;
  z-index:1200;

  -webkit-overflow-scrolling: touch;
  touch-action: pan-y;
  overscroll-behavior: contain;
}
#sidebar.closed{transform:translateX(-100%);box-shadow:none;border-right:none;}
#toggle-btn{
  position:absolute;
  top:20px;left:340px;
  width:28px;height:48px;
  background:#fff;border:1px solid #d0d7df;border-left:none;
  border-radius:0 6px 6px 0;
  display:flex;align-items:center;justify-content:center;
  cursor:pointer;z-index:2000;
  box-shadow:0 1px 3px rgba(0,0,0,0.15);
  transition:background 0.2s ease, left .35s ease;
}
#toggle-btn:hover{background:#f3f4f6;}
#toggle-btn span{font-size:14pt;color:#e5e7eb;user-select:none;}
#sidebar h1{font-weight:700;font-size:12pt;margin:4px 0 8px;}
#sidebar .description{font-weight:400;font-style: normal;font-size:8pt;color:#445;line-height:1.2;margin-bottom:12px;
  text-align: left !important;
  word-spacing: normal;
  letter-spacing: normal;

  text-align: justify !important;
  text-align-last: left;
}
#search{width:100%;padding:6px 8px;font-size:8pt;font-style:italic;border:1px solid #d0d7df;border-radius:6px;margin-bottom:12px;box-sizing:border-box;}
#search:focus { outline: none !important; }

.film{margin-bottom:10px;border-bottom:1px solid #f0f4f8;padding-bottom:8px;}
#film-list{margin-bottom:0 !important;padding-bottom:0 !important;}

.film:last-of-type{margin-bottom:0;border-bottom:none;padding-bottom:0;}
.film-title{cursor:pointer;font-weight:500;font-size:11pt;color:#e5e7eb;margin-bottom:6px;}
.mekan-list{list-style:disc;margin:0 0 0 18px;padding:0;display:none;}
.mekan-list li{font-weight:400;font-size:9pt;margin-bottom:6px;cursor:pointer;color:#e5e7eb;}
.mekan-list li:hover{text-decoration:underline;}
#map{position:absolute;left:0;top:0;right:0;bottom:0;z-index:1;}
.leaflet-control-zoom{position:absolute !important;bottom: 30px;right:20px;transform: scale(0.75);border-radius:6px;box-shadow:0 1px 2px rgba(0,0,0,0.1);}
.leaflet-popup-content img{max-width:200px;height:auto;border-radius:6px;margin-top:6px;display:block;}
.leaflet-popup-content-wrapper {width:280px !important;max-width:280px !important;}
.leaflet-popup-content { font-family: -apple-system, BlinkMacSystemFont, 'Helvetica Neue', Helvetica, Arial, sans-serif !important; font-weight: 400; }



.numeric-scale {
      position:absolute;
      top:8px;
      bottom:auto;
      right:8px;
      z-index:1000;
      background:rgba(255,255,255,0.7);
      border-radius:4px;
      padding:2px 6px;
      font-size:10px;
      color:#374151;
      font-family:system-ui, sans-serif;
      pointer-events:none;
    }
    .map-attribution{
      position:absolute;
      bottom:6px;
      right:8px;
      z-index:1000;
      background:rgba(255,255,255,0.7);
      border-radius:4px;
      padding:2px 6px;
      font-size:10px;
      color:#374151;
      font-family:system-ui, sans-serif;
      line-height:1.2;
    }
    .map-attribution .credit-full{ display:none; }
    .map-attribution .credit-short{ display:inline; }

    /* Hover / focus ile tam kredi metnini g√∂ster */
    .map-attribution:hover .credit-full,
    .map-attribution:focus-within .credit-full{ display:inline; }
    .map-attribution:hover .credit-short,
    .map-attribution:focus-within .credit-short{ display:none; }

    /* Mobilde hover yok: tam metin her zaman g√∂r√ºns√ºn */
    @media (max-width: 768px){
      .map-attribution .credit-full{ display:inline; }
      .map-attribution .credit-short{ display:none; }
    }

    .map-attribution a{
      color:#374151;
      text-decoration:none;
    }
    .map-attribution a:hover{ text-decoration:underline; }






.leaflet-control-zoom {
  display: none !important;
  visibility: hidden !important;
}




.leaflet-control-attribution {
  display: none !important;
  visibility: hidden !important;
  opacity: 0 !important;
  height: 0 !important;
  overflow: hidden !important;
  margin: 0 !important;
  padding: 0 !important;
}



.tab-btn.active {
  background: #e8ecf3 !important;
  font-weight: 600 !important;
  border-color: #ccc !important;
}


.tab-btn {
  transition: background-color 0.25s ease, box-shadow 0.25s ease, transform 0.15s ease;
}
.tab-btn:hover {
  background: #f1f4f9 !important;
  box-shadow: 0 1px 4px rgba(0,0,0,0.08);
  transform: translateY(-1px);
}


.tab-content {
  display: none;
  opacity: 0;
  visibility: hidden;
  transition: opacity 0.4s ease, visibility 0.4s ease;
}
.tab-content.active-visible {
  display: block;
  opacity: 1;
  visibility: visible;
  position: relative;
  z-index: 10;
}
.tab-content {
  display: none;
  opacity: 0;
  transition: opacity 0.4s ease;
}
.tab-content.active-visible {
  display: block;
  opacity: 1;
}


.film-title {
  transition: background-color 0.18s ease, transform 0.12s ease, box-shadow 0.18s ease, color 0.18s ease;
  padding:6px 8px;
  border-radius:6px;
}
.film-title:hover {
  background: #f1f4f9;
  transform: translateY(-2px);
  box-shadow: 0 1px 6px rgba(0,0,0,0.06);
  color: #111;
}
.mekan-list li {
  transition: transform 0.16s ease, color 0.16s ease, padding-left 0.16s ease;
  padding-left:2px;
  border-radius:4px;
}
.mekan-list li:hover {
  transform: translateX(4px);
  color: #111;
  text-decoration: none;
  background: rgba(0,0,0,0.01);
  padding-left:6px;
}

#filter-info { font-size:12px; color:#0f172a; display:none; }
#filter-info .btn-clear { margin-left:8px; cursor:pointer; color:#2563eb; font-weight:600; text-decoration:underline; background:none;border:none;padding:0; }



.film-title.selected {
  background: #e8ecf3 !important;
  font-weight: 600;
  box-shadow: 0 1px 4px rgba(0,0,0,0.08);
  border-radius: 6px;
  transform: translateY(-1px);
}


#map-filter-info {
  color: #444455 !important;
}
#map-filter-info .btn-clear:hover {
  background: #f2f4fa !important;
}

#map-filter-info {
  color: #444455 !important;
}

#map-filter-info .btn-clear {
  margin-left: 8px;
  cursor: pointer;
  font-weight: 500;
  background: #f2f3f7; 
  color: #333;
  border: none; 
  border-radius: 6px;
  padding: 6px 10px;
  transition: background-color 0.25s ease, box-shadow 0.25s ease, transform 0.15s ease;
}

#map-filter-info .btn-clear:hover {
  background: #f2f4fa !important;
  box-shadow: 0 1px 4px rgba(0,0,0,0.08);
  transform: translateY(-1px);
}


@media (max-width: 768px) {

  .tab-btn {
    color: #333 !important;
  }


  #sidebar {
    width: 200px !important;
  }


  #toggle-btn {
    left: 200px !important;
  }


  #sidebar.closed + #toggle-btn {
    left: 0 !important;
  }
}



@media (max-width: 768px) {

  #sidebar {
    width: 220px !important;
  }


  #toggle-btn {
    left: 220px !important;
  }

  #sidebar.closed + #toggle-btn {
    left: 0 !important;
  }


  #map-filter-info {
    width: 90% !important;
    max-width: 90% !important;
    font-size: 11px !important;
    padding: 4px 8px !important;
    text-align: center !important;
    bottom: 10px !important;
    left: 50% !important;
    transform: translateX(-50%) !important;
    border-radius: 8px !important;
  }
}


@media (max-width: 768px) {
  .numeric-scale {
    display: none !important;
  }
}


@media (max-width: 768px) {
  .film-title {
    font-size: 10pt !important;
  }
}



.leaflet-popup-content img[src=""], 
.leaflet-popup-content img:not([src]), 
.leaflet-popup-content img[src*="lh3.googleusercontent.com"],
.leaflet-popup-content img[src*="mymaps.usercontent.google.com"] {
  display: none !important;
}


.carousel-container {
  margin-top: 4px;
  display: inline-block;
}

.carousel-controls {
  margin-top: 4px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.carousel-buttons {
  display: flex;
  gap: 4px;
}

.carousel-btn {
  border: 1px solid #d0d7df;
  background: #f5f7fa;
  border-radius: 4px;
  padding: 2px 6px;
  font-size: 11px;
  line-height: 1.2;
  cursor: pointer;
  font-family: inherit;
  color: #333;
}

.carousel-btn:hover {
  background: #e8ecf3;
}

.carousel-counter {
  font-size: 10px;
  color: #555;
  padding: 2px 6px;
  border-radius: 4px;
  border: 1px solid #d0d7df;
  background: #f9fafb;
  font-family: inherit;
}


.period-btn {
  display:block;
  width:100%;
  text-align:left;
  padding:6px 8px;
  margin-bottom:6px;
  font-size:11pt;
  border:1px solid #f0f4f8;
  border-radius:6px;
  background:#fff;
  color:#e5e7eb;
  cursor:pointer;
  transition: background-color 0.18s ease, transform 0.12s ease, box-shadow 0.18s ease;
}
.period-btn:hover {
  background:#f1f4f9;
  transform: translateY(-2px);
  box-shadow:0 1px 6px rgba(0,0,0,0.06);
}
.period-btn.active {
  background:#e8ecf3 !important;
  font-weight:600 !important;
  box-shadow:0 1px 4px rgba(0,0,0,0.08);
  transform: translateY(-1px);
}

#map-filter-info .btn-clear {
  border: none !important;
  outline: none !important;
  box-shadow: none !important;
}

.description-justify{
  text-align: justify;
  text-align-last: left;
}

.cc-license{
  font-size: 8pt;
  line-height: 1.25;
  color: #9ca3af;
  margin-top: 6px;
}

.cc-license a{
  color: #374151;
  text-decoration: none;
}
.cc-license a:hover{
  text-decoration: underline;
}

</style>

<style>
.leaflet-popup-content .carousel-image {
    display: none !important;
}
.leaflet-popup-content .carousel-image.active {
    display: block !important;
}
</style>


<style>
/* --- Sinematik koyu tema override'larƒ± --- */

#sidebar .description{
  text-align: justify !important;
  text-align-last: left;
}


body {
  background: #020617;
  color: #e5e7eb;
}

#sidebar {
  background: #020617;
  border-right: 1px solid #111827;
  box-shadow: 2px 0 12px rgba(0,0,0,0.65);
}

#sidebar h1 {
  color: #e5e7eb;
}

#sidebar .description {
  color: #9ca3af;
}

#toggle-btn {
  background: #020617;
  border-color: #111827;
}

#toggle-btn:hover {
  background: #1a2235;
}

#search {
  background: #020617;
  border-color: #1f2933;
  color: #e5e7eb;
}

#search::placeholder {
  color: #6b7280;
}

.film-title {
  display: block;
  width: 100%;
  text-align: left;
  background: #020617;
  border: 1px solid #1f2933;
  border-radius: 6px;
  padding: 6px 8px;
  margin: 0 0 6px 0;
  color: #e5e7eb;
  box-sizing: border-box;
}
.film {
  border-bottom: none !important;
  padding-bottom: 0 !important;
  margin-bottom: 8px;
}


.film-title:hover {
  background: #1a2235;
  border-color: #334155;
  color: #e5e7eb;
}

.film-title.selected {
  background: #1a2235 !important;
  border-color: #e63946 !important;
  box-shadow: 0 0 0 1px rgba(230,57,70,0.45);
}

.mekan-list li {
  color: #cbd5f5;
}

.mekan-list li:hover {
  background: #1a2235;
  color: #e5e7eb;
}

.tab-btn {
  background: #020617 !important;
  border-color: #1f2933 !important;
  color: #e5e7eb !important;
}

.tab-btn:hover {
  background: #1a2235 !important;
}

.tab-btn.active {
  background: #1a2235 !important;
  border-color: #e63946 !important;
}

.period-btn {
  background: #020617;
  border-color: #1f2933;
  color: #e5e7eb;
}

.period-btn:hover {
  background: #1a2235;
}

.period-btn.active {
  background: #1a2235 !important;
  border-color: #e63946 !important;
  box-shadow: 0 0 0 1px rgba(230,57,70,0.4);
}

.leaflet-popup-content-wrapper {
  background: #020617;
  color: #e5e7eb;
  border: 1px solid #111827;
}

.leaflet-popup-content {
  color: #e5e7eb;
}

#map-filter-info {
  background: rgba(15,23,42,0.92) !important;
  border-color: rgba(15,23,42,1) !important;
  color: #e5e7eb !important;
}

#map-filter-info .btn-clear {
  background: #e63946 !important;
  color: #e5e7eb !important;
  border: 0 !important;
}

#map-filter-info .btn-clear:hover {
  background: #b91c1c !important;
  border-color: #f97373 !important;
}

.numeric-scale {
  background: rgba(15,23,42,0.9);
  color: #e5e7eb;
}

.map-attribution{
  background: rgba(15,23,42,0.9);
  color: #e5e7eb;
}
.map-attribution a{
  color: #cbd5f5;
}




.cc-license a{ color: #cbd5f5; }
.carousel-btn {
  background: #020617;
  border-color: #1f2933;
  color: #e5e7eb;
}

.carousel-btn:hover {
  background: #1a2235;
}

.carousel-counter {
  background: #020617;
  border-color: #1f2933;
  color: #e5e7eb;
}

#map {
  border-radius: 10px;
  box-shadow: 0 0 0 12px #0b1120 inset;
  border: 6px solid #0b1120;
  overflow: hidden;
}

/* Sidebar kapalƒ±yken √ßer√ßeveyi kaldƒ±r */
#sidebar.closed ~ #map {
  border-radius: 0 !important;
  box-shadow: none !important;
  border: none !important;
}
</style>

<style>
/* Popup √º√ßgenini (tip) koyu popup ile aynƒ± renge getir ‚Äì sadece rengi dokun, ≈üekle deƒüil */
.leaflet-popup-tip {
  background: #020617 !important;  /* popup ile aynƒ± zemin */
  box-shadow: none !important;     /* beyaz/soluk kenar g√∂lgesini kaldƒ±r */
}
</style>

<style>
#search:hover {
  background:#1b2236 !important;
  color:#e5e7eb !important;
}
#search:focus {
  background:#1b2236 !important;
  color:#e5e7eb !important;
  outline:none !important;
  border-color:#1f2933 !important;
  box-shadow:none !important;
}
</style>


<style>
#left-edge-hotspot {
  position: fixed;
  left: 0;
  top: 0;
  width: 24px;
  height: 100vh;
  z-index: 1400;
  pointer-events: auto;
}

/* Mobilde men√º a√ßƒ±kken sol hotspot dokunu≈ülarƒ± √ßalmasƒ±n */
#sidebar:not(.closed) ~ #left-edge-hotspot { pointer-events: none; }
#sidebar.closed ~ #left-edge-hotspot { pointer-events: auto; }

#bottom-edge-hotspot {
  position: fixed;
  left: 0;
  bottom: 0;
  width: 100vw;
  height: 80px;
  z-index: 0;
  pointer-events: none;
}
#map-filter-info {
  transition: opacity 0.25s ease;
}
</style>

<style>
#sidebar-slider {
  margin: 6px 0 10px 0;
}

/* Biraz daha yatay ve kompakt bir oran (yakla≈üƒ±k 2.3:1) */
.slider-image-wrapper {
  position: relative;
  width: 100%;
  padding-top: 42%;
  overflow: hidden;
  border-radius: 10px;
  border: 1px solid #1f2933;
  background: #020617;
  box-shadow: 0 8px 20px rgba(0,0,0,0.6);
}

#sidebar-slider-image {
  position: absolute;
  inset: 0;
  width: 100%;
  height: 100%;
  object-fit: cover;
  opacity: 0;
  transition: opacity 0.8s ease;
}

#sidebar-slider-image.visible {
  opacity: 1;
}

/* Noktalarƒ± tamamen gizle */
.slider-dots {
  display: none !important;
}

.slider-dot {
  width: 6px;
  height: 6px;
  border-radius: 999px;
  background: #4b5563;
  opacity: 0.6;
  cursor: pointer;
  transition: opacity 0.2s ease, transform 0.15s ease, background-color 0.2s ease, width 0.2s ease;
}

.slider-dot.active {
  opacity: 1;
  background: #e63946;
  transform: translateY(-1px);
  width: 14px;
}
</style>


<style>
#film-list mark {
  background-color: #5a70ad;
  color: #e5e7eb;
  padding: 0 1px;
  border-radius: 2px;
}
</style>


<style>
/* Film listesinde a≈üaƒüƒ±da i√ßerik olduƒüunu ima eden "scroll hint" */

#scroll-hint{
  position: sticky;
  bottom: 0;
  width: 100%;
  height: 52px;
  background: linear-gradient(to bottom, rgba(2,6,23,0), rgba(2,6,23,0.92) 55%, rgba(2,6,23,0.98));
  display: none;
  align-items: center;
  justify-content: center;
  pointer-events: none;
  z-index: 30;
}

#scroll-hint .hint-pill{
  display:flex;
  align-items:center;
  gap:8px;
  padding:6px 10px;
  border-radius:999px;
  background: rgba(15,23,42,0.85);
  border: 1px solid rgba(148,163,184,0.22);
  box-shadow: 0 6px 18px rgba(0,0,0,0.45);
  backdrop-filter: blur(6px);
}

#scroll-hint .hint-icon{
  font-size: 22px;
  line-height: 1;
  color: #e5e7eb;
  text-shadow: 0 2px 8px rgba(0,0,0,0.55);
  animation: scrollPulse 1.35s ease-in-out infinite;
}

#scroll-hint .hint-text{
  font-size: 10px;
  letter-spacing: .12em;
  text-transform: uppercase;
  color: rgba(229,231,235,0.82);
}

@keyframes scrollPulse{
  0%   { transform: translateY(0); opacity: .65; }
  50%  { transform: translateY(7px); opacity: 1; }
  100% { transform: translateY(0); opacity: .65; }
}

/* Desktop'ta daha minimal istersen yazƒ±yƒ± kapat */
@media (min-width: 769px){
  #scroll-hint .hint-text{ opacity: 0.0; width:0; overflow:hidden; padding:0; margin:0; }
  #scroll-hint .hint-pill{ padding:6px 12px; }
}
50%  { transform: translateY(6px); opacity: 1; }
  100% { transform: translateY(0); opacity: .4; }
}
</style>

</head>
<body>
<aside id="sidebar">
<h1>Ankara‚Äônƒ±n Sinemasal Kartografyasƒ±</h1>

<div class="description description-justify">Bu √ßalƒ±≈üma Ankara √úni¬≠versitesi Sosyal Bilimler Ensti¬≠t√ºs√º Radyo Tele¬≠vizyon ve Sinema Anabilim Dalƒ±‚Äônda Prof. Dr. S. Ruken √ñzt√ºrk danƒ±≈ü¬≠manlƒ±ƒüƒ±nda Sezer Ahmet Kƒ±na tara¬≠fƒ±ndan y√ºr√º¬≠t√ºlen <i>Sinemada Kentin D√∂n√º¬≠≈ü√ºm√ºn√º Seyretmek: Ankara √ñrneƒüi</i> ba≈ülƒ±klƒ± doktora tezi i√ßin hazƒ±r¬≠lanmƒ±≈ütƒ±r.</div>

<p class="cc-license" xmlns:cc="http://creativecommons.org/ns#" xmlns:dct="http://purl.org/dc/terms/">
  <a property="dct:title" rel="cc:attributionURL" href="https://ankaracinemap.sezerkina.com">Ankara'nƒ±n Sinemasal Kartografyasƒ±</a> (2022),
  <a rel="cc:attributionURL dct:creator" property="cc:attributionName" href="https://sezerkina.com">Sezer Ahmet KINA</a>
  tarafƒ±ndan
  <a href="https://creativecommons.org/licenses/by-nc-nd/4.0/deed.tr" rel="noopener noreferrer" target="_blank">
    CC BY-NC-ND
  </a>
  ile lisanslanmƒ±≈ütƒ±r.
</p>


<div id="sidebar-slider">
  <div class="slider-image-wrapper">
    <img id="sidebar-slider-image" src="" alt="Ankara sinematik g√∂rseli"/>
  </div>
  <div class="slider-dots"></div>
</div>

<div id="tab-menu"
 style="display:flex;gap:8px;margin-bottom:12px;">
<button class="tab-btn" data-tab="filmler" style="flex:1;padding:6px 4px;border:1px solid #ccc;border-radius:6px;background:#fff;cursor:pointer;">Filmler ve Mek√¢nlar</button>
<button class="tab-btn" data-tab="yogunluk" style="flex:1;padding:6px 4px;border:1px solid #ccc;border-radius:6px;background:#fff;cursor:pointer;">Mek√¢nsal Yoƒüunluk</button>
<button class="tab-btn" data-tab="bolgesel" style="flex:1;padding:6px 4px;border:1px solid #ccc;border-radius:6px;background:#fff;cursor:pointer;">B√∂lgesel Daƒüƒ±lƒ±m</button>
</div>

<div class="tab-content active" id="tab-filmler">
<input aria-label="Haritada ara" id="search" placeholder="Haritada ara"/>
<div id="film-list"></div>
<div id="scroll-hint" aria-hidden="true"><span>‚åÑ</span></div>
</div>

<div class="tab-content" id="tab-yogunluk">
  <div id="period-buttons" style="display:flex; gap:6px; margin-bottom:10px; flex-wrap:wrap;">
    <button class="period-btn" data-period="1966-1980">1966‚Äì1980: Ye≈üil√ßam'ƒ±n Modern Ankara'sƒ±</button>
    <button class="period-btn" data-period="1988-2001">1988‚Äì2001: Neoliberal √áevrim ve Yeni Merkezler</button>
    <button class="period-btn" data-period="2010-2022">2010‚Äì2022: Daƒüƒ±nƒ±k Odak, Par√ßalƒ± Metropol</button>
  </div>
  <div id="yogunluk-content"></div>

<div class="tab-content" id="tab-bolgesel">
  <!-- B√∂lgesel Daƒüƒ±lƒ±m i√ßeriƒüi daha sonra eklenecek -->
</div>

</div>

</aside>
<div id="toggle-btn"><span>‚óÇ</span></div>
<div id="left-edge-hotspot"></div>
<div id="bottom-edge-hotspot"></div>
<div id="map">
<div id="map-filter-info" style="display:none;position:absolute;bottom:18px;left:50%;transform:translateX(-50%);background:rgba(255,255,255,0.85);backdrop-filter:blur(6px);border:1px solid rgba(0,0,0,0.1);border-radius:10px;padding:6px 12px;font-size:13px;color:#111;z-index:1500;box-shadow:0 2px 4px rgba(0,0,0,0.08);"></div>
<div class="map-attribution" aria-label="Harita altyapƒ± kredileri">
  <span class="credit-short">‚ìò Map credits</span>
  <span class="credit-full">
    ¬© <a href="https://carto.com/" target="_blank" rel="noopener">CARTO</a> ¬∑
    ¬© <a href="https://www.openstreetmap.org/copyright" target="_blank" rel="noopener">OpenStreetMap</a> contributors
  </span>
</div>
</div>
<script>
function cleanFolderName(folder){
  if(!folder) return "";
  return folder.replace(/[\/|]+/g, '').trim();
}

const DEFAULT_CENTER = [39.93, 32.85];
const DEFAULT_ZOOM = 11;
const hitRenderer = L.canvas({tolerance:18});
const map = L.map('map', {preferCanvas:true, tap:true, tapTolerance:20}).setView(DEFAULT_CENTER, DEFAULT_ZOOM);
L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
  maxZoom: 22, }).addTo(map);
const scaleDiv = L.DomUtil.create('div', 'numeric-scale', map.getContainer());
function updateNumericScale() {
  const centerLat = map.getCenter().lat;
  const metersPerPixel = 156543.03392 * Math.cos(centerLat * Math.PI / 180) / Math.pow(2, map.getZoom());
  const scaleDenominator = Math.round(39.37 * metersPerPixel * 96);
  scaleDiv.textContent = '1 : ' + scaleDenominator.toLocaleString('tr-TR');
}
map.on('moveend zoomend', updateNumericScale);
updateNumericScale();


let films = {};
let featureToLayer = new Map();
let allLayers = L.layerGroup().addTo(map);
let allKmzFeatures = [];

let featureToLayers = new Map();

function __indexFeatureLayer(feat, layer){
  if(!feat || !layer) return;
  let arr = featureToLayers.get(feat);
  if(!arr){
    arr = [];
    featureToLayers.set(feat, arr);
  }
  arr.push(layer);
}

function __getActiveBaseFeaturesForSearch(){
  // Eƒüer bir film se√ßiliyse (showOnlyFilm), arama sadece o filmin feature'larƒ± i√ßinde √ßalƒ±≈üsƒ±n
  const sel = document.querySelector('.film-title.selected');
  if(sel){
    const filmName = (sel.textContent || '').trim();
    if(filmName && films && films[filmName]) return films[filmName];
  }
  return allKmzFeatures || [];
}

function __renderFeaturesToMap(feats){
  allLayers.clearLayers();
  const b = L.latLngBounds([]);
  (feats || []).forEach(f=>{
    const layers = featureToLayers.get(f) || [];
    layers.forEach(l=>{
      try{
        allLayers.addLayer(l);
        // bounds toplama: layer tipine g√∂re
        if(l.getLatLng) b.extend(l.getLatLng());
        else if(l.getBounds) b.extend(l.getBounds());
      }catch(e){}
    });
  });
  try{
    if(b.isValid && b.isValid()) map.fitBounds(b.pad(0.08), { padding: [20,20], maxZoom: 16, animate: true });
  }catch(e){}
}


function __escapeRegExp(s){
  return s.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
}

// Unicode uyumlu "tam kelime" yakalama (T√ºrk√ße karakterlerle de √ßalƒ±≈üsƒ±n diye \b yerine kullanƒ±yoruz)
function __makeTokenRegex(token){
  const t = (token || '').trim();
  if(!t) return null;

  // √áok kelimeli ifade: par√ßa i√ßinde arama (includes) mantƒ±ƒüƒ±na uygun basit regex
  if(t.includes(' ')){
    return new RegExp(__escapeRegExp(t), 'iu');
  }

  // Tek kelime: kelime sƒ±nƒ±rƒ± ≈üartƒ± (harf/rakam dƒ±≈üƒ± karakterlerle √ßevrili olsun)
  // (^|[^\p{L}\p{N}_]) token ([^\p{L}\p{N}_]|$)
  return new RegExp('(^|[^\\p{L}\\p{N}_])(' + __escapeRegExp(t) + ')([^\\p{L}\\p{N}_]|$)', 'iu');
}



// Akƒ±llƒ± arama:
// - "tƒ±rnak i√ßi ifade" tek bir token olarak aranƒ±r
// - + kullanƒ±lƒ±rsa t√ºm token'lar aynƒ± anda (AND) aranƒ±r
// - + yoksa token'lardan herhangi biri (OR) yeter
function __parseSmartQuery(raw){
  const s = (raw || '').trim();
  if(!s) return { raw:'', tokens:[], requireAll:false };

  const tokens = [];
  // √ßift tƒ±rnak i√ßi ifadeleri √ßek
  const re = /"([^"]+)"/g;
  let m;
  while((m = re.exec(s)) !== null){
    const phrase = (m[1] || '').trim();
    if(phrase) tokens.push(phrase.toLowerCase());
  }
  // tƒ±rnaklƒ± kƒ±sƒ±mlarƒ± √ßƒ±kar
  const remainder = s.replace(re, ' ').trim();

  // + i≈üareti AND g√∂stergesi
  const requireAll = remainder.includes('+') || s.includes('+');

  // kalan par√ßalarƒ± + ve bo≈üluklardan b√∂l
  const parts = remainder.split(/\s*\+\s*|\s+/).map(p=>p.trim()).filter(Boolean);
  parts.forEach(p => tokens.push(p.toLowerCase()));

  // bo≈ü token temizle
  const clean = tokens.filter(t=>t && t.length);

  return { raw:s, tokens: clean, requireAll };
}

function __matchTextSmart(haystack, parsed){
  const h = (haystack || '').toLowerCase();
  const tokens = parsed && parsed.tokens ? parsed.tokens : [];
  if(!tokens.length) return true;

  const tests = (t) => {
    const rx = __makeTokenRegex(t);
    if(!rx) return false;
    return rx.test(h);
  };

  if(parsed.requireAll){
    return tokens.every(t => tests(t));
  }
  return tokens.some(t => tests(t));
}


function __escapeHtml(str){
  return (str || '')
    .replace(/&/g, '&amp;')
    .replace(/</g, '&lt;')
    .replace(/>/g, '&gt;')
    .replace(/"/g, '&quot;')
    .replace(/'/g, '&#39;');
}

function __highlightSmart(text, parsed){
  const tokens = (parsed && parsed.tokens) ? parsed.tokens.slice() : [];
  let out = __escapeHtml(text || '');
  if(!tokens.length) return out;

  tokens.sort((a,b)=>b.length-a.length);

  tokens.forEach(tok=>{
    if(!tok) return;
    const rx = __makeTokenRegex(tok);
    if(!rx) return;

    // Tek kelime regex'inde yakalanan grup(2) token, √ßevresi grup1/grup3 ‚Äî bunlarƒ± koruyarak mark'la
    if(tok.includes(' ')){
      out = out.replace(new RegExp(__escapeRegExp(tok), 'giu'), m => '<mark>' + m + '</mark>');
    } else {
      out = out.replace(rx, (full, pre, mid, post) => (pre || '') + '<mark>' + (mid || '') + '</mark>' + (post || ''));
    }
  });

  return out;
}

function __applySearchDeterministic(q){
  const parsed = __parseSmartQuery(q);
  const baseFeats = __getActiveBaseFeaturesForSearch();

  if(!parsed.tokens.length){
    // Arama bo≈üsa: mevcut moda g√∂re base feature'larƒ± geri √ßiz
    __renderFeaturesToMap(baseFeats);
    return;
  }

  const matched = [];
  baseFeats.forEach(f=>{
    const props = f && f.properties ? f.properties : {};
    const hay = ((props.name || '')).toString();
    if(__matchTextSmart(hay, parsed)) matched.push(f);
  });

  __renderFeaturesToMap(matched);
}

// Harita odak/zoom'unu her tu≈ü vuru≈üunda zƒ±platmamak i√ßin debounce
let __searchDebounceTimer = null;
function __applySearchDeterministicDebounced(qRaw){
  if(__searchDebounceTimer) clearTimeout(__searchDebounceTimer);
  __searchDebounceTimer = setTimeout(() => {
    __applySearchDeterministic(qRaw);
  }, 250);
}


function loadKmzs(onComplete, options){
  const __opts = options || {};
  const __buildSidebarList = (__opts.buildSidebarList !== false);

  fetch('kmzs.geojson').then(r=>r.json()).then(data=>{
    films = {}; featureToLayer = new Map(); featureToLayers = new Map(); allLayers.clearLayers();
    allKmzFeatures = [];
    data.features.forEach(f=>{
      let year = null;
      if (f.properties) {
        if (typeof f.properties.year === 'number') {
          year = f.properties.year;
        } else {
          const folderStr = f.properties.folder || '';
          const ym = folderStr.match(/\b(19[0-9]{2}|20[0-2][0-9])\b/);
          if (ym) year = parseInt(ym[0]);
        }
        if (year) f.properties._year = year;
      }
      allKmzFeatures.push(f);
      const folder = cleanFolderName(f.properties?.folder) || "Bilinmeyen Film";
      const name = f.properties?.name || "(Adsƒ±z Mek√¢n)";
      if(!films[folder]) films[folder]=[];
      films[folder].push(f);

      const geom = f.geometry;
      if(!geom) return;

      const styleProps = f.properties?.style || {};
      const color = styleProps.fillColor || '#e63946';
      let layer = null;
      if(geom.type === 'Point'){
        const coords = [geom.coordinates[1], geom.coordinates[0]];
        const radius = styleProps.radius || 6;
        layer = L.circleMarker(coords, {renderer: hitRenderer, 
          radius,
          color,
          fillColor: styleProps.fillColor || color,
          fillOpacity: ('fillOpacity' in styleProps) ? styleProps.fillOpacity : 1
        });
      } else if(geom.type === 'MultiPoint'){
        const coords = geom.coordinates.map(c => [c[1], c[0]]);
        const group = L.featureGroup(coords.map(c => L.circleMarker(c, {renderer: hitRenderer, radius: styleProps.radius||6, color, fillColor: styleProps.fillColor||color, fillOpacity: ('fillOpacity' in styleProps)? styleProps.fillOpacity:1})));
        layer = group;
      } else if(geom.type === 'LineString' || geom.type === 'MultiLineString'){
        const coords = (geom.type === 'LineString') ? geom.coordinates.map(c => [c[1], c[0]]) : geom.coordinates.map(line => line.map(c => [c[1], c[0]]));
        layer = (geom.type === 'LineString') ? L.polyline(coords, {renderer: hitRenderer, color: color, weight: 3, opacity: 0.9}) : L.featureGroup(coords.map(line => L.polyline(line, {renderer: hitRenderer, color: color, weight:3, opacity:0.9})));
      } else if(geom.type === 'Polygon' || geom.type === 'MultiPolygon'){
        const coords = (geom.type === 'Polygon') ? geom.coordinates.map(ring => ring.map(c => [c[1], c[0]])) : geom.coordinates.map(poly => poly.map(ring => ring.map(c => [c[1], c[0]])));
        layer = (geom.type === 'Polygon') ? L.polygon(coords, {renderer: hitRenderer, color: color, weight:2, fillColor: color, fillOpacity:0.3}) : L.featureGroup(coords.map(poly => L.polygon(poly, {renderer: hitRenderer, color: color, weight:2, fillColor: color, fillOpacity:0.3})));
      }

      if(layer){

const props = f.properties || {};
let desc = props.description || '';
let rawImgs = (desc.match(/<img[^>]*>/gi) || []);
desc = desc.replace(/<img[^>]*>/gi, '').trim();

let imgs = [];
if (Array.isArray(props.images)) {
  imgs = props.images.map(src => `<img class='carousel-image' src="${src}" alt="">`);
} else {
  if (props.image) rawImgs.push(`<img class='carousel-image' src="${props.image}" alt="">`);
  imgs = rawImgs;
}

let popup = `<div style="font-family:-apple-system, BlinkMacSystemFont, 'Helvetica Neue', Helvetica, Arial, sans-serif !important;">`;
popup += `<div style="font-weight:700;font-size:11pt;margin-bottom:4px;">${name}</div>`;
popup += `<div style="font-weight:500;font-size:10pt;margin-bottom:6px;">${folder}</div>`;
if(desc){ popup += `<div style="font-weight:400;font-size:9pt;margin-bottom:8px;">${desc}</div>`; }

if (imgs.length === 1) {
  popup += imgs[0].replace("carousel-image", "");
} else if (imgs.length > 1) {
  imgs = imgs.map((im,i)=>im.replace("carousel-image", i===0 ? "carousel-image active" : "carousel-image"));
  popup += `
    <div class="carousel-container">
      ${imgs.join('')}
      <div class="carousel-controls">
        <div class="carousel-buttons">
          <button class="carousel-btn prev" onclick="carouselPrev(this)">‚Äπ</button>
          <button class="carousel-btn next" onclick="carouselNext(this)">‚Ä∫</button>
        </div>
        <div class="carousel-counter">1 / ${imgs.length}</div>
      </div>
    </div>`;
}
popup += `</div>`;
if(layer.getLayers && typeof layer.getLayers === 'function'){
          layer.getLayers().forEach(ch => { if(ch.bindPopup) ch.bindPopup(popup); ch.feature = f; allLayers.addLayer(ch); featureToLayer.set(f, ch); __indexFeatureLayer(f, ch); if (ch.on) {
      ch.on('click', function(){
        let tc=null;
        if (ch.getLatLng) tc=ch.getLatLng();
        else if (ch.getBounds) tc=ch.getBounds().getCenter();
        if (tc) map.panTo(tc,{animate:true});
      });
    }
    });
        } else {

           if(layer.bindPopup) layer.bindPopup(popup);

if (layer instanceof L.Polyline && !(layer instanceof L.Polygon)) {
  layer.off('click'); // varsa eski click eventini kaldƒ±r
  layer.on('click', function (e) {
    const center = layer.getBounds().getCenter();
    map.openPopup(popup, center);
  });
}

          layer.feature = f;
          allLayers.addLayer(layer);
          featureToLayer.set(f, layer); __indexFeatureLayer(f, layer); if (layer.on) {
      layer.on('click', function(){
        let tc=null;
        if (layer.getLatLng) tc=layer.getLatLng();
        else if (layer.getBounds) tc=layer.getBounds().getCenter();
        else if (layer.getLayers && typeof layer.getLayers==='function'){
          try{
            const gb=L.latLngBounds([]);
            layer.getLayers().forEach(sub=>{
              if(sub.getLatLng) gb.extend(sub.getLatLng());
              else if(sub.getBounds) gb.extend(sub.getBounds());
            });
            if(gb.isValid && gb.isValid()) tc=gb.getCenter();
          }catch(e){}
        }
        if (tc) map.panTo(tc,{animate:true});
      });
    }
  if (layer.on) {
    layer.on('click', function() {
      let targetCenter = null;
      if (layer.getLatLng) targetCenter = layer.getLatLng();
      else if (layer.getBounds) targetCenter = layer.getBounds().getCenter();
      else if (layer.getLayers && typeof layer.getLayers === 'function') {
        try {
          const groupBounds = L.latLngBounds([]);
          layer.getLayers().forEach(sub => {
            if (sub.getLatLng) groupBounds.extend(sub.getLatLng());
            else if (sub.getBounds) groupBounds.extend(sub.getBounds());
          });
          if (groupBounds.isValid()) targetCenter = groupBounds.getCenter();
        } catch (err) {}
      }
      if (targetCenter) map.panTo(targetCenter, { animate: true });
    });
  }

        }
      }
    });

    try{
      const b=allLayers.getBounds();
      if(b && b.isValid && b.isValid()) map.fitBounds(b.pad(0.08));
    }catch(e){ map.setView([39.93,32.85],11); }

    if(__buildSidebarList){
    const filmList = document.getElementById('film-list');
    filmList.innerHTML = '';
    Object.keys(films)
    .sort((a,b)=>{
      const ya=parseInt((a.match(/\d{4}/)||[0])[0]);
      const yb=parseInt((b.match(/\d{4}/)||[0])[0]);
      return (ya||9999)-(yb||9999);
    })
    .forEach(film=>{
      const div=document.createElement('div');
      div.className='film';
      const title=document.createElement('div');
      title.className='film-title';
      title.textContent=film;
      const ul=document.createElement('ul');
      ul.className='mekan-list';

      films[film].forEach(feat=>{
        const li=document.createElement('li');
        li.textContent=feat.properties.name||'(Adsƒ±z Mekan)';
        li.dataset.rawText = li.textContent;
        li.onclick = (e) => {
  e.stopPropagation();
  const layer = featureToLayer.get(feat);
  if (!layer) return;

  let targetCenter = null;
  let bounds = L.latLngBounds([]);

  if (layer.getLatLng) {
    targetCenter = layer.getLatLng();
  }

  else if (layer.getBounds) {
    bounds.extend(layer.getBounds());
  }

  else if (layer.getLayers && typeof layer.getLayers === "function") {
    layer.getLayers().forEach((sub) => {
      if (sub.getLatLng) bounds.extend(sub.getLatLng());
      else if (sub.getBounds) bounds.extend(sub.getBounds());
    });
  }

  if (bounds.isValid && bounds.isValid()) {
    targetCenter = bounds.getCenter();
  }

  if (targetCenter) {
    map.setView(targetCenter, 16, { animate: true });
    setTimeout(() => map.panTo(targetCenter, { animate: true }), 200);
  }

  if (layer.openPopup) {
    layer.openPopup();
  } else if (layer.getLayers && typeof layer.getLayers === "function") {
    const firstSub = layer.getLayers()[0];
    if (firstSub && firstSub.openPopup) firstSub.openPopup();
  }

  if (window.innerWidth <= 768) {
    const sidebar = document.getElementById("sidebar");
    const toggle = document.getElementById("toggle-btn");
    const arrow = toggle.querySelector("span");
    sidebar.classList.add("closed");
    toggle.style.left = "0";
    arrow.textContent = "‚ñ∏";
  }
};
        ul.appendChild(li);
      });

      title.onclick = function(e) {
  document.querySelectorAll('.mekan-list').forEach(list => {
    if (list !== ul) list.style.display = 'none';
  });

  showOnlyFilm(film);

  ul.style.display = (ul.style.display === 'none' || ul.style.display === '') ? 'block' : 'none';
};
      div.appendChild(title);
      div.appendChild(ul);
      filmList.appendChild(div);
    });

    } else {
      // B√∂lgesel Daƒüƒ±lƒ±m sekmesinde sidebar listeleme yok
      const filmList = document.getElementById('film-list');
      if (filmList) filmList.innerHTML = '';
    }
    const searchInput = document.getElementById('search');
    searchInput.addEventListener('input',(e)=>{
      const qRaw = e.target.value;
      const parsed = __parseSmartQuery(qRaw);
      __applySearchDeterministicDebounced(qRaw);
document.querySelectorAll('.film').forEach(div=>{
        const title = div.querySelector('.film-title').textContent.toLowerCase();
        const liNodes = Array.from(div.querySelectorAll('li'));
        const lis = liNodes.map(li=>li.textContent.toLowerCase());
        const match = !parsed.tokens.length || lis.some(t=>__matchTextSmart(t, parsed));
        div.style.display = match ? 'block' : 'none';

        if(parsed.tokens.length){
          // highlight + renk ayarƒ± mark ile yapƒ±lacak
          liNodes.forEach(li=>{
            const text = li.dataset.rawText || li.textContent;
            li.innerHTML = __highlightSmart(text, parsed);
          });

          // e≈üle≈üen mekan(lar)ƒ± listenin en √ºst√ºne ta≈üƒ±
          const ul = div.querySelector('.mekan-list');
          if (ul) {
            const matchingLis = [];
            const nonMatchingLis = [];
            Array.from(ul.querySelectorAll('li')).forEach(li=>{
              const t = (li.dataset.rawText || li.textContent).toLowerCase();
              if (__matchTextSmart(t, parsed)) matchingLis.push(li);
              else nonMatchingLis.push(li);
            });
            ul.innerHTML = '';
            matchingLis.concat(nonMatchingLis).forEach(li=>ul.appendChild(li));
          }
        } else {

          // arama kutusu bo≈üsa highlight'larƒ± temizle
          liNodes.forEach(li=> { li.innerHTML = __escapeHtml(li.dataset.rawText || li.textContent); });
        }
      });
    });

    if(onComplete) onComplete();
    clearFilterInfo();
  }).catch(err=>{
    console.error('kmzs.geojson y√ºkleme hatasƒ±', err);
    if(onComplete) onComplete(err);
  });
}

function loadHeatmap(periodKey){
  clearFilterInfo();
  allLayers.clearLayers();
  if (!allKmzFeatures.length) return;

  let minYear = 0, maxYear = 9999;
  if (periodKey === '1966-1980') { minYear = 1966; maxYear = 1980; }
  else if (periodKey === '1988-2001') { minYear = 1988; maxYear = 2001; }
  else if (periodKey === '2010-2022') { minYear = 2010; maxYear = 2022; }

  const points = [];

  allKmzFeatures.forEach(f => {
    const props = f.properties || {};
    const year = props._year;
    if (!year || year < minYear || year > maxYear) return;

    const layer = featureToLayer.get(f);
    if (!layer) return;

    const addPointFromLatLng = (latlng) => {
      if (!latlng) return;
      points.push([latlng.lat, latlng.lng, 1.6]);
    };

    if (layer.getLatLng) {
      addPointFromLatLng(layer.getLatLng());
    } else if (layer.getBounds) {
      addPointFromLatLng(layer.getBounds().getCenter());
    } else if (layer.getLayers && typeof layer.getLayers === 'function') {
      try{
        const groupBounds = L.latLngBounds([]);
        layer.getLayers().forEach(sub => {
          if (sub.getLatLng) groupBounds.extend(sub.getLatLng());
          else if (sub.getBounds) groupBounds.extend(sub.getBounds());
        });
        if (groupBounds.isValid && groupBounds.isValid()) {
          addPointFromLatLng(groupBounds.getCenter());
        }
      }catch(e){}
    }

    if (window.__updateScrollHint) setTimeout(window.__updateScrollHint, 120);
  });

  if (!points.length) {
    console.warn('Se√ßilen d√∂nem i√ßin heatmap noktasƒ± bulunamadƒ±.');
    return;
  }

  L.heatLayer(points, {
    radius: 42,
    blur: 26,
    maxZoom: 19,
    max: 1.0,
    minOpacity: 0.25,
    gradient: {
      0.0: '#000000',
      0.3: '#2b0000',
      0.5: '#660000',
      0.7: '#b30000',
      0.85: '#ff4500',
      1.0: '#ffd000'
    }
  }).addTo(allLayers);

  try{
    const b = allLayers.getBounds();
    if (b && b.isValid && b.isValid()) map.fitBounds(b.pad(0.08));
  }catch(e){}
}

function clearData(){ allLayers.clearLayers(); clearFilterInfo(); }


function pulseLayer(layer){
  try{
    if(!layer) return;
    if(typeof layer.setRadius === 'function' && (layer instanceof L.CircleMarker || layer instanceof L.Circle)){
      var orig = layer.options && (layer.options.radius || layer.getRadius && layer.getRadius()) ? (layer.getRadius ? layer.getRadius() : layer.options.radius) : 6;
      var bigger = Math.round(orig * 2.5);
      layer.setRadius(bigger);
      setTimeout(function(){ try{ layer.setRadius(orig); }catch(e){} }, 1000);
    } else if(typeof layer.setStyle === 'function'){
      var origWeight = (layer.options && layer.options.weight) ? layer.options.weight : 3;
      layer.setStyle({weight: Math.max(2, origWeight*1.8)});
      if(layer.bringToFront) layer.bringToFront();
      setTimeout(function(){ try{ layer.setStyle({weight: origWeight}); }catch(e){} }, 1000);
    }
  }catch(e){ console.error('pulseLayer error', e); }
}

function showFilterInfo(filmName){
  var fi = document.getElementById('map-filter-info');
  fi.innerHTML = 'üéûÔ∏è&nbsp;&nbsp;≈ûu anda yalnƒ±zca <strong>' + filmName + '</strong> filmi g√∂r√ºnt√ºleniyor. '
               + '<button class="btn-clear" onclick="restoreAll()">T√ºm√ºn√º G√∂ster</button>';
  fi.style.display = 'block';
}
function clearFilterInfo(){
  var fi = document.getElementById('map-filter-info');
  if(fi){ fi.style.display='none'; fi.innerHTML=''; }
}
function restoreAll(){
  clearFilterInfo();
  document.querySelectorAll('.film-title').forEach(ft=>ft.classList.remove('selected'));
  loadKmzs();
}
function showOnlyFilm(filmName){
  document.querySelectorAll('.film-title').forEach(ft => ft.classList.remove('selected'));
  document.querySelectorAll('.film-title').forEach(ft => {
    if(ft.textContent.trim() === filmName.trim()) ft.classList.add('selected');
  });
  if(!films || !films[filmName]) return;
  allLayers.clearLayers();
  var bounds = L.latLngBounds([]);
  films[filmName].forEach(function(f){
    var layer = featureToLayer.get(f);
    if(!layer) return;
    if(layer.getLayers && typeof layer.getLayers === 'function'){
      layer.getLayers().forEach(function(ch){
        allLayers.addLayer(ch);
        if(ch.getLatLng) bounds.extend(ch.getLatLng());
        else if(ch.getBounds) bounds.extend(ch.getBounds());
      });
    } else {
      allLayers.addLayer(layer);
      if(layer.getLatLng) bounds.extend(layer.getLatLng());
      else if(layer.getBounds) bounds.extend(layer.getBounds());
    }
  });
  try{
    if(bounds.isValid && bounds.isValid()) map.fitBounds(bounds.pad(0.08));
  }catch(e){ console.error('fitBounds error', e); }
  showFilterInfo(filmName);


}



function showPeriodFilterInfo(periodText){
  var fi = document.getElementById('map-filter-info');
  fi.innerHTML =
    'üó∫Ô∏è&nbsp;&nbsp;≈ûu anda yalnƒ±zca <strong>' + periodText + ' d√∂nemi</strong> daƒüƒ±lƒ±mƒ± ve yoƒüunluƒüu g√∂r√ºnt√ºleniyor. ' +
    '<button class="btn-clear" onclick="restoreAllPeriods()">T√ºm√ºn√º G√∂ster</button>';
  fi.style.display = 'block';
}

function restoreAllPeriods(){
  clearFilterInfo();
  document.querySelectorAll('.period-btn').forEach(b => b.classList.remove('active'));
  loadFullHeatmap();
}

function loadFullHeatmap(){
  clearFilterInfo();
  allLayers.clearLayers();
  if (!allKmzFeatures.length) return;

  const points = [];

  allKmzFeatures.forEach(f => {
    const layer = featureToLayer.get(f);
    if (!layer) return;

    const addPointFromLatLng = (latlng) => {
      if (!latlng) return;
      points.push([latlng.lat, latlng.lng, 1.6]);
    };

    if (layer.getLatLng) {
      addPointFromLatLng(layer.getLatLng());
    } else if (layer.getBounds) {
      addPointFromLatLng(layer.getBounds().getCenter());
    } else if (layer.getLayers && typeof layer.getLayers === 'function') {
      try{
        const groupBounds = L.latLngBounds([]);
        layer.getLayers().forEach(sub => {
          if (sub.getLatLng) groupBounds.extend(sub.getLatLng());
          else if (sub.getBounds) groupBounds.extend(sub.getBounds());
        });
        if (groupBounds.isValid && groupBounds.isValid()) {
          addPointFromLatLng(groupBounds.getCenter());
        }
      }catch(e){}
    }
  });

  if (!points.length) {
    console.warn('T√ºm d√∂nemler i√ßin heatmap noktasƒ± bulunamadƒ±.');
    return;
  }

  L.heatLayer(points, {
    radius: 42,
    blur: 26,
    maxZoom: 19,
    max: 1.0,
    minOpacity: 0.25,
    gradient: {
      0.0: '#000000',
      0.3: '#2b0000',
      0.5: '#660000',
      0.7: '#b30000',
      0.85: '#ff4500',
      1.0: '#ffd000'
    }
  }).addTo(allLayers);

  try{
    const b = allLayers.getBounds();
    if (b && b.isValid && b.isValid()) map.fitBounds(b.pad(0.08));
  }catch(e){}
}

const sidebar=document.getElementById('sidebar');
const toggle=document.getElementById('toggle-btn');
const arrow=toggle.querySelector('span');
toggle.addEventListener('click', () => {
  sidebar.classList.toggle('closed');
  const isClosed = sidebar.classList.contains('closed');

  if (isClosed) {
    toggle.style.left = '0';
    arrow.textContent = '‚ñ∏';
  } else {
    toggle.style.left = '340px';
    arrow.textContent = '‚óÇ';
  }

  map.invalidateSize();
});





document.querySelectorAll('.tab-btn').forEach(btn=>{
  btn.addEventListener('click', () => {
    document.querySelectorAll('.tab-content').forEach(tc => tc.classList.remove('active-visible'));

    document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
    document.getElementById('tab-filmler').classList.toggle('active-visible', btn.dataset.tab === 'filmler');
    document.getElementById('tab-yogunluk').classList.toggle('active-visible', btn.dataset.tab === 'yogunluk');
    document.getElementById('tab-bolgesel').classList.toggle('active-visible', btn.dataset.tab === 'bolgesel');

    if(btn.dataset.tab === 'filmler'){
      document.getElementById('tab-filmler').classList.add('active-visible');

      document.getElementById('search').style.display = 'block';
      document.getElementById('film-list').style.display = 'block';
      loadKmzs();
document.getElementById('tab-filmler').classList.add('active-visible');
document.getElementById('tab-filmler').classList.add('active-visible');
document.querySelector('.tab-btn[data-tab="filmler"]').classList.add('active');
    } else if(btn.dataset.tab === 'yogunluk'){
      document.getElementById('tab-yogunluk').classList.add('active-visible');

      document.getElementById('search').style.display = 'none';
      document.getElementById('film-list').style.display = 'none';

      document.querySelectorAll('.period-btn').forEach(b => b.classList.remove('active'));
      loadFullHeatmap();
      clearFilterInfo();
      map.setView(DEFAULT_CENTER, DEFAULT_ZOOM, { animate: true });

    } else if(btn.dataset.tab === 'bolgesel'){
      document.getElementById('tab-bolgesel').classList.add('active-visible');

      // B√∂lgesel Daƒüƒ±lƒ±m: kmzs.geojson katmanƒ± (Tab1 ile aynƒ±), sidebar liste yok
      document.getElementById('search').style.display = 'none';
      document.getElementById('film-list').style.display = 'none';

      document.querySelectorAll('.period-btn').forEach(b => b.classList.remove('active'));
      clearFilterInfo();
      loadKmzs(null, { buildSidebarList: false });
      map.setView(DEFAULT_CENTER, DEFAULT_ZOOM, { animate: true });

    } else {

      document.getElementById('search').style.display = 'none';
      document.getElementById('film-list').style.display = 'none';
      clearData();
    }
  });
});

document.querySelectorAll('.period-btn').forEach(btn => {
  btn.addEventListener('click', () => {
    document.querySelectorAll('.period-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    const periodKey = btn.getAttribute('data-period');
    const yogunlukTabBtn = document.querySelector('.tab-btn[data-tab="yogunluk"]');
    if (yogunlukTabBtn && yogunlukTabBtn.classList.contains('active')) {
      loadHeatmap(periodKey);

      const periodText = btn.textContent.split(':')[0].trim();
      showPeriodFilterInfo(periodText);
    }
  });
});

loadKmzs();
document.getElementById('tab-filmler').classList.add('active-visible');
document.getElementById('tab-filmler').classList.add('active-visible');
document.querySelector('.tab-btn[data-tab="filmler"]').classList.add('active');

</script>

<script>
function carouselNext(btn){
  const container = btn.closest('.carousel-container');
  if (!container) return;
  const imgs = container.querySelectorAll('.carousel-image');
  const counter = container.querySelector('.carousel-counter');
  if (!imgs.length) return;
  let i = [...imgs].findIndex(im => im.classList.contains('active'));
  if (i === -1) i = 0;

  imgs[i].classList.remove('active');
  const newIndex = (i + 1) % imgs.length;
  imgs[newIndex].classList.add('active');

  if (counter) {
    counter.textContent = (newIndex + 1) + ' / ' + imgs.length;
  }
}
function carouselPrev(btn){
  const container = btn.closest('.carousel-container');
  if (!container) return;
  const imgs = container.querySelectorAll('.carousel-image');
  const counter = container.querySelector('.carousel-counter');
  if (!imgs.length) return;
  let i = [...imgs].findIndex(im => im.classList.contains('active'));
  if (i === -1) i = 0;

  imgs[i].classList.remove('active');
  const newIndex = (i - 1 + imgs.length) % imgs.length;
  imgs[newIndex].classList.add('active');

  if (counter) {
    counter.textContent = (newIndex + 1) + ' / ' + imgs.length;
  }
}
</script>


<script>
// --- Sidebar otomatik fotoƒüraf slider'ƒ± ---

// Buraya kendi GitHub (raw) g√∂rsel URL'lerini ekleyebilirsin:
const sidebarSliderImages = [
  "images/menu-images/m_i_1.jpg",
  "images/menu-images/m_i_2.jpg",
  "images/menu-images/m_i_3.jpg",
  "images/menu-images/m_i_4.jpg",
  "images/menu-images/m_i_5.jpg",
  "images/menu-images/m_i_6.jpg",
  "images/menu-images/m_i_7.jpg",
  "images/menu-images/m_i_8.jpg",
  "images/menu-images/m_i_9.jpg",
  "images/menu-images/m_i_10.jpg"
];

(function initSidebarSlider(){
  if (!sidebarSliderImages || sidebarSliderImages.length === 0) return;

  const imgEl = document.getElementById('sidebar-slider-image');
  const dotsContainer = document.querySelector('.slider-dots');
  if (!imgEl || !dotsContainer) return;

  let currentIndex = 0;
  let intervalId = null;

  function renderDots() {
    dotsContainer.innerHTML = '';
    sidebarSliderImages.forEach((_, idx) => {
      const dot = document.createElement('div');
      dot.className = 'slider-dot' + (idx === currentIndex ? ' active' : '');
      dot.addEventListener('click', () => {
        goToSlide(idx, true);
      });
      dotsContainer.appendChild(dot);
    });
  }

  function goToSlide(index, resetTimer) {
    currentIndex = (index + sidebarSliderImages.length) % sidebarSliderImages.length;
    const url = sidebarSliderImages[currentIndex];

    imgEl.classList.remove('visible');
    // K√º√ß√ºk bir timeout ile fade ge√ßi≈üini daha yumu≈üak yapalƒ±m
    setTimeout(() => {
      imgEl.src = url;
      imgEl.onload = () => {
        imgEl.classList.add('visible');
      };
    }, 80);

    const dots = dotsContainer.querySelectorAll('.slider-dot');
    dots.forEach((d, i) => {
      d.classList.toggle('active', i === currentIndex);
    });

    if (resetTimer && intervalId) {
      clearInterval(intervalId);
      startAutoPlay();
    }
  }

  function startAutoPlay() {
    intervalId = setInterval(() => {
      goToSlide(currentIndex + 1, false);
    }, 2000); // 2 saniyede bir deƒüi≈üsin
  }

  // Ba≈ülangƒ±√ß
  renderDots();
  goToSlide(0, false);
  startAutoPlay();
})();
</script>


<script>
// --- Sidebar scroll ipucu (film listesi a≈üaƒüƒ± doƒüru uzuyorsa) ---
(function initSidebarScrollHint(){
  const sidebar = document.getElementById('sidebar');
  const tabFilmler = document.getElementById('tab-filmler');
  const scrollHint = document.getElementById('scroll-hint');
  if(!sidebar || !tabFilmler || !scrollHint) return;

  function isFilmlerActive(){
    return tabFilmler.classList.contains('active-visible');
  }

  function updateScrollHint(){
    // Sadece "Filmler" sekmesindeyken ve sidebar ger√ßekten kaydƒ±rƒ±labiliyorken g√∂ster
    const canScroll = sidebar.scrollHeight > (sidebar.clientHeight + 6);
    const nearTop = sidebar.scrollTop < 8;
    if (isFilmlerActive() && canScroll && nearTop) {
      scrollHint.style.display = 'flex';
    } else {
      scrollHint.style.display = 'none';
    }
  }

  sidebar.addEventListener('scroll', updateScrollHint, {passive:true});
  window.addEventListener('resize', updateScrollHint);

  // kmz/film listesi her yenilendiƒüinde y√ºkseklik deƒüi≈üebilir
  const obs = new MutationObserver(() => updateScrollHint());
  obs.observe(tabFilmler, {childList:true, subtree:true});

  // ilk √∂l√ß√ºm
  setTimeout(updateScrollHint, 350);

  // dƒ±≈üarƒ±dan da √ßaƒürƒ±labilsin (tab deƒüi≈üiminde)
  window.__updateScrollHint = updateScrollHint;
})();
</script>




</body>
</html>
